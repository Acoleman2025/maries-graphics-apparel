<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shop - Marie's Graphics and Apparel</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #fff0f5;
      margin: 0;
      padding: 20px;
    }
    header, footer {
      background-color: #ff69b4;
      color: white;
      text-align: center;
      padding: 1rem;
    }
    nav {
      background-color: #ffc0cb;
      text-align: center;
      padding: 1rem;
    }
    nav a {
      margin: 0 1rem;
      color: #333;
      text-decoration: none;
      font-weight: bold;
    }
    .products {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      justify-content: center;
      padding: 2rem 0;
    }
    .product {
      background: white;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 250px;
    }
    .product img {
      width: 100%;
      border-radius: 8px;
    }
    button {
      background-color: #ff69b4;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background-color: #ff4c94;
    }
    #cart {
      position: fixed;
      top: 10%;
      right: 10px;
      width: 300px;
      max-height: 80vh;
      overflow-y: auto;
      background: white;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 1rem;
      display: none;
      z-index: 1000;
    }
    #cart h2 {
      margin-top: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #cart h2 button {
      background: transparent;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
      color: #ff69b4;
    }
    #cart ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #cart ul li {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      align-items: center;
      gap: 5px;
    }
    #cart-footer {
      font-weight: bold;
      margin-top: 1rem;
      text-align: right;
    }
    #cart-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #ff69b4;
      color: white;
      border: none;
      padding: 0.8rem 1rem;
      border-radius: 50px;
      font-weight: bold;
      cursor: pointer;
      z-index: 1100;
    }
    /* Fix label spacing */
    label {
      margin-top: 0.5rem;
      display: inline-block;
    }

    /* Checkout styles */
    #checkout-section {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 400px;
      margin: 2rem auto;
    }
    #checkout-cart .cart-item {
      margin-bottom: 10px;
    }
    #checkout-cart .cart-item:last-child {
      margin-bottom: 0;
    }
    #checkout-cart {
      margin-bottom: 1rem;
    }
    #checkout-total {
      font-weight: bold;
      font-size: 1.2rem;
    }
    #checkout-form input, #checkout-form button {
      display: block;
      margin-top: 10px;
      padding: 8px;
      width: 100%;
      box-sizing: border-box;
      font-size: 1rem;
    }

    /* Quantity controls */
    .qty-controls {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .qty-controls button {
      background-color: #ff69b4;
      border: none;
      color: white;
      font-weight: bold;
      font-size: 1rem;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      user-select: none;
    }
    .qty-controls span {
      min-width: 20px;
      text-align: center;
      font-weight: bold;
      font-size: 1rem;
      display: inline-block;
    }
  </style>
</head>
<body>
  <header>
    <h1>Shop at Marie's Graphics and Apparel</h1>
  </header>

  <nav>
    <a href="index.html">Home</a>
    <a href="index.html#about">About</a>
    <a href="index.html#contact">Contact</a>
  </nav>

  <section class="products">
    <div class="product" data-id="logo-cap" data-name="Logo Cap" data-price="14.99">
      <img src="Navy Cap.png" />
      <h3>Samford Ball Cap</h3>
      <p>$14.99</p>
      <p class="stock-status">✔ In Stock</p>
      <p class="disclaimer">*Images are for illustrative purposes only. Actual product may vary in appearance and features. Embroidery is not offered.</p>
    
      <button class="add-to-cart">Add to Cart</button>
    </div>

    <div class="product" data-id="samford-tumbler" data-name="Samford Tumbler" data-price="24.99">
      <img src="Cup.png" alt="Samford Tumbler" />
      <h3>Samford Tumbler</h3>
      <p>$24.99</p>
      <p class="stock-status">✔ In Stock</p>
      <p class="disclaimer">*Images are for illustrative purposes only. Actual product may vary in appearance and features. Embroidery is not offered.</p>
   
      <button class="add-to-cart">Add to Cart</button>
    </div>

    <div class="product" data-id="samford-tote" data-name="Samford Tote" data-price="24.99">
      <img src="Samford Tote.jpg" alt="Samford Tote" />
      <h3>Samford Stadium Tote</h3>
      <p>$24.99</p>
      <p class="stock-status">✔ In Stock</p>
      <p class="disclaimer">*Images are for illustrative purposes only. Actual product may vary in appearance and features. Embroidery is not offered.</p>
    
      <button class="add-to-cart">Add to Cart</button>
    </div>

        <div class="product" data-id="Samford Dogs Only Tee" data-name="Samford Dogs Only Tee" data-price="24.99">
          <img id="shirt-image" src="Navy.jgp.png" alt="Samford Dogs Only Tee"/>
      <h3>Samford Dogs Only Tee</h3>
      <p>$24.99</p>
          <p class="stock-status">✔ In Stock</p>
      <label for="size-sdo">Size:</label>
      <select id="size-sdo" name="size">
        <option value="">-- Select Size --</option>
        <option value="S">Small</option>
        <option value="M">Medium</option>
        <option value="L">Large</option>
        <option value="XL">X-Large</option>
        <option value="2XL">2X-Large</option>
        <option value="3XL">3X-Large</option>
        </select>
       
      <label for="color-sdo">Color:</label>
      <select id="color-sdo" name="color">
        <option value="">-- Select Color --</option>
        <option value="White">White</option>
        <option value="Navy">Navy</option>
      </select>
          <p class="disclaimer">*Images are for illustrative purposes only. Actual product may vary in appearance and features. Embroidery is not offered.</p>
    
          <button class="add-to-cart">Add to Cart</button>
    </div>

       <div class="product" data-id="Samford White tee" data-name="Samford White tee" data-price="24.99">
      <img id="shirt-image" src="White Tee.png" alt="Samford White tee"/>
         <h3>Samford White Tee</h3>
      <p>$24.99</p>
         <p class="stock-status">✔ In Stock</p>
     <label for="size-sdo">Size:</label>
      <select id="size-sdo" name="size">
        <option value="">-- Select Size --</option>
        <option value="S">Small</option>
        <option value="M">Medium</option>
        <option value="L">Large</option>
        <option value="XL">X-Large</option>
        <option value="2XL">2X-Large</option>
        <option value="3XL">3X-Large</option>
        </select>
       <p class="disclaimer">*Images are for illustrative purposes only. Actual product may vary in appearance and features. Embroidery is not offered.</p>
    
         <button class="add-to-cart">Add to Cart</button>
    </div>

        <div class="product" data-id="Samford Red tee" data-name="Samford Red tee" data-price="24.99">
           <img id="shirt-image" src="Red Tee.png" alt="Samford Red tee"/>
      <h3>Samford Red Tee</h3>
      <p>$24.99</p>
          <p class="stock-status">✔ In Stock</p>
      <label for="size-sdo">Size:</label>
      <select id="size-sdo" name="size">
        <option value="">-- Select Size --</option>
        <option value="S">Small</option>
        <option value="M">Medium</option>
        <option value="L">Large</option>
        <option value="XL">X-Large</option>
        <option value="2XL">2X-Large</option>
        <option value="3XL">3X-Large</option>
        </select>
        <p class="disclaimer">*Images are for illustrative purposes only. Actual product may vary in appearance and features. Embroidery is not offered.</p>
    
          <button class="add-to-cart">Add to Cart</button>
    </div>

    <div class="product" data-id="sun-visor" data-name="Sun Visor" data-price="14.99">
      <img src="Visor.png" alt="Visor" />
      <h3>Samford Sun Visor</h3>
      <p>$14.99</p>
      <p class="stock-status">✔ In Stock</p>
      <p class="disclaimer">*Images are for illustrative purposes only. Actual product may vary in appearance and features. Embroidery is not offered.</p>
    <button class="add-to-cart">Add to Cart</button>
    </div>
  </section>

  <button id="cart-toggle">Cart (0)</button>

  <div id="cart">
    <h2>
      Your Cart
      <button id="close-cart" title="Close Cart">&times;</button>
    </h2>
    <ul id="cart-items"></ul>
    <div id="cart-footer">Total: $0.00</div>
    <button id="checkout-button">Checkout</button>
  </div>

  <!-- Checkout Section -->
 <section id="checkout-section" style="display:none;">
  <h2>Checkout</h2>
  <div id="checkout-cart"></div>
  <p class="total">Total: $<span id="checkout-total">0.00</span></p>

  <h3>Shipping Info</h3>
  <form id="checkout-form">
    <input type="text" id="name" placeholder="Full Name" required />
    <input type="email" id="email" placeholder="Email" required />
    <input type="text" id="address" placeholder="Address" required />
    <input type="text" id="city" placeholder="City" required />
    <input type="text" id="zip" placeholder="ZIP Code" required />

    <!-- Square Card payment input will attach here -->
    <div id="card-container" style="margin: 1rem 0;"></div>

    <button type="submit">Place Order</button>
  </form>
</section>

<!-- Load Square payment SDK -->
<script src="https://sandbox.web.squarecdn.com/v1/square.js"></script>

<script>
  console.log("Shop page script running");

  // Your existing code omitted for brevity...

  // Initialize Square payments
  const payments = Square.payments('sq0idp-yBj05c7DSsg9Wsql9ETwug', 'LTNPX98YE7YP0');
  let card;

  async function initializeCard() {
    card = await payments.card();
    await card.attach('#card-container');
  }
  initializeCard();

  async function tokenize(paymentMethod) {
    const result = await paymentMethod.tokenize();
    if (result.status === 'OK') {
      return result.token;
    } else {
      throw new Error('Tokenization failed: ' + (result.errors ? result.errors[0].message : 'Unknown error'));
    }
  }

  // Checkout form submission handler
checkoutForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  // Collect form data
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const address = document.getElementById('address').value.trim();
  const city = document.getElementById('city').value.trim();
  const zip = document.getElementById('zip').value.trim();

  if (!name || !email || !address || !city || !zip) {
    alert('Please fill in all shipping fields.');
    return;
  }

  try {
    const token = await tokenize(card);

    // Calculate total amount from cartItems
    const totalAmount = cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);

    // Call backend to process payment
    const response = await fetch('/api/process-payment', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        token,
        amount: totalAmount,
        name,
        email,
        address,
        city,
        zip,
      }),
    });

    const data = await response.json();

    if (response.ok && data.success) {
      alert(`Payment successful! Thank you for your order, ${name}!`);

      cartItems = [];
      localStorage.removeItem('cart');
      updateCartUI();

      checkoutForm.reset();
      checkoutSection.style.display = 'none';
    } else {
      alert(`Payment failed: ${data.error || 'Unknown error'}`);
    }
  } catch (error) {
    alert(`Payment error: ${error.message}`);
  }
});

  // Your existing updateCartUI and other functions...

  // Initial UI update
  updateCartUI();
</script>

    <h3>Shipping Info</h3>
    <form id="checkout-form">
      <input type="text" id="name" placeholder="Full Name" required />
      <input type="email" id="email" placeholder="Email" required />
      <input type="text" id="address" placeholder="Address" required />
      <input type="text" id="city" placeholder="City" required />
      <input type="text" id="zip" placeholder="ZIP Code" required />
      <button type="submit">Place Order</button>
    </form>
  </section>

  <footer>
    <p>&copy; 2025 Marie's Graphics and Apparel. All rights reserved.</p>
     <nav>
    <a href="PrivatePolicy.html">Private Policy</a>
    <a href="TermsandCondition.html">Terms and Conditions</a>
    <a href="ReturnandRefund.html">Return and Refund Policy</a>
    <a href="ShippingPolicy.html">Shipping Policy</a>
    <a href="FAQ.html">FAQ</a>
    </nav>
   
    <img src="Affinity-Color_ALP_Seal_Image_tif_-0.png" style="width:120px; margin-top: 1rem;" />
  </footer>

  <script>
    console.log("Shop page script running");

    // Update shirt image based on color selection
    const shirtImage = document.getElementById('shirt-image');
    const colorSelect = document.getElementById('color-sdo');

    const colorToImage = {
      White: "ChatGPT Image Jun 6, 2025, 03_46_39 PM.png",
      Navy: "Navy.jgp.png",
          };

    colorSelect.addEventListener('change', () => {
      const selectedColor = colorSelect.value;
      shirtImage.src = colorToImage[selectedColor] || colorToImage.White;
      shirtImage.alt = `Samford "Dogs Only" ${selectedColor} Tee`;
    });

    // Cart Elements
    const cartToggle = document.getElementById('cart-toggle');
    const cart = document.getElementById('cart');
    const closeCartBtn = document.getElementById('close-cart');
    const cartItemsContainer = document.getElementById('cart-items');
    const cartFooter = document.getElementById('cart-footer');
    const checkoutSection = document.getElementById('checkout-section');
    const checkoutCartDiv = document.getElementById('checkout-cart');
    const checkoutTotalSpan = document.getElementById('checkout-total');

    // Load cart from localStorage or start empty
    let cartItems = JSON.parse(localStorage.getItem('cart')) || [];

    // Add to Cart button handler
    document.querySelectorAll('.add-to-cart').forEach(button => {
      button.addEventListener('click', (e) => {
        const productDiv = e.target.closest('.product');
        if (!productDiv) return;

        const id = productDiv.getAttribute('data-id');
        const name = productDiv.getAttribute('data-name');
        const price = parseFloat(productDiv.getAttribute('data-price'));

        // Get selected size and color if they exist
        const sizeSelect = productDiv.querySelector('select[name="size"]');
        const colorSelect = productDiv.querySelector('select[name="color"]');

        const size = sizeSelect ? sizeSelect.value : '';
        const color = colorSelect ? colorSelect.value : '';

        // Validate selection if applicable
        if (sizeSelect && !size) {
          alert('Please select a size.');
          return;
        }
        if (colorSelect && !color) {
          alert('Please select a color.');
          return;
        }

        // Check if the same product (with same options) is already in cart
        const existingIndex = cartItems.findIndex(item =>
          item.id === id && item.size === size && item.color === color
        );

        if (existingIndex > -1) {
          cartItems[existingIndex].quantity++;
        } else {
          cartItems.push({ id, name, price, quantity: 1, size, color });
        }

        localStorage.setItem('cart', JSON.stringify(cartItems));
        updateCartUI();
        alert(`${name} added to cart!`);
      });
    });

    // Update Cart UI
    function updateCartUI() {
      cartItemsContainer.innerHTML = '';
      let total = 0;
      cartItems.forEach((item, index) => {
        const li = document.createElement('li');
        const itemName = document.createElement('span');
        let desc = item.name;
        if (item.size) desc += ` (Size: ${item.size})`;
        if (item.color) desc += ` (Color: ${item.color})`;
        itemName.textContent = desc;

        const qtyControls = document.createElement('span');
        qtyControls.className = 'qty-controls';

        const btnMinus = document.createElement('button');
        btnMinus.textContent = '-';  // <-- FIXED: ASCII hyphen-minus instead of Unicode minus
        btnMinus.title = 'Decrease quantity';
        btnMinus.addEventListener('click', () => {
          if (item.quantity > 1) {
            item.quantity--;
          } else {
            cartItems.splice(index, 1);
          }
          localStorage.setItem('cart', JSON.stringify(cartItems));
          updateCartUI();
        });

        const qtySpan = document.createElement('span');
        qtySpan.textContent = item.quantity;

        const btnPlus = document.createElement('button');
        btnPlus.textContent = '+';
        btnPlus.title = 'Increase quantity';
        btnPlus.addEventListener('click', () => {
          item.quantity++;
          localStorage.setItem('cart', JSON.stringify(cartItems));
          updateCartUI();
        });

        qtyControls.appendChild(btnMinus);
        qtyControls.appendChild(qtySpan);
        qtyControls.appendChild(btnPlus);

        const priceSpan = document.createElement('span');
        priceSpan.textContent = '$' + (item.price * item.quantity).toFixed(2);

        li.appendChild(itemName);
        li.appendChild(qtyControls);
        li.appendChild(priceSpan);

        cartItemsContainer.appendChild(li);

        total += item.price * item.quantity;
      });

      cartFooter.textContent = 'Total: $' + total.toFixed(2);
      cartToggle.textContent = `Cart (${cartItems.reduce((a, c) => a + c.quantity, 0)})`;

      // Also update checkout summary if visible
      if (checkoutSection.style.display === 'block') {
        renderCheckoutCart();
      }
    }

    // Show/Hide Cart
    cartToggle.addEventListener('click', () => {
      if (cart.style.display === 'block') {
        cart.style.display = 'none';
      } else {
        cart.style.display = 'block';
        checkoutSection.style.display = 'none';
      }
    });
    closeCartBtn.addEventListener('click', () => {
      cart.style.display = 'none';
    });

    // Checkout button
    const checkoutButton = document.getElementById('checkout-button');
    checkoutButton.addEventListener('click', () => {
      if (cartItems.length === 0) {
        alert('Your cart is empty.');
        return;
      }
      cart.style.display = 'none';
      checkoutSection.style.display = 'block';
      renderCheckoutCart();
    });

    // Render checkout cart items summary
    function renderCheckoutCart() {
      checkoutCartDiv.innerHTML = '';
      let total = 0;
      cartItems.forEach(item => {
        const div = document.createElement('div');
        div.className = 'cart-item';
        let desc = item.name;
        if (item.size) desc += ` (Size: ${item.size})`;
        if (item.color) desc += ` (Color: ${item.color})`;
        div.textContent = `${desc} x ${item.quantity} - $${(item.price * item.quantity).toFixed(2)}`;
        checkoutCartDiv.appendChild(div);
        total += item.price * item.quantity;
      });
      checkoutTotalSpan.textContent = total.toFixed(2);
    }

    // Checkout form submission
    const checkoutForm = document.getElementById('checkout-form');
    checkoutForm.addEventListener('submit', (e) => {
      e.preventDefault();

      // Collect form data
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const address = document.getElementById('address').value.trim();
      const city = document.getElementById('city').value.trim();
      const zip = document.getElementById('zip').value.trim();

      if (!name || !email || !address || !city || !zip) {
        alert('Please fill in all shipping fields.');
        return;
      }

      // For demo: Just clear cart and show thank you message
      alert(`Thank you for your order, ${name}!`);

      cartItems = [];
      localStorage.removeItem('cart');
      updateCartUI();

      checkoutForm.reset();
      checkoutSection.style.display = 'none';
    });

    // Initial UI update
    updateCartUI();
  </script>
</body>
</html>
